# レビューモード

既存コードのレビュー＆修正を実行します。

## 対象
$ARGUMENTS

## 実行フロー

```
Gemini(コンテキスト調査) → Codex(レビュー) → Gemini(ヒント) → Claude(修正) → ループ
```

## 実行手順

### Step 0: 対象の特定

引数の解釈:
- 引数なし → 未コミットの変更全体 (`git diff --name-only`)
- ファイルパス → 指定ファイル
- ディレクトリパス → 指定ディレクトリ配下

### Step 1: Gemini コンテキスト調査

以下の形式で表示してから、Geminiにコンテキスト調査を依頼:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 レビューモード
対象: [対象パス]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌐 Step 1: Geminiコンテキスト調査
```

Geminiへの依頼内容:
- プロジェクト全体を読み込み
- 対象ファイルの依存関係マップを作成
- 影響範囲・リスク評価
- レビュー観点の特定

### Step 2: Codex レビュー

```bash
codex review --uncommitted
```

結果を以下の形式で表示:

```
🔍 Step 2: Codexレビュー
スコア: XX/100 (Critical: X, Warning: X)

指摘事項:
- [severity] file:line - message
```

**判定:**
- 80点以上 → 完了（Step 5へ）
- 80点未満 → Step 3へ

### Step 3: Gemini 修正ヒント生成

Geminiに依頼:
- Codexの指摘をコンテキストと照合
- 各指摘の本質的な問題を特定
- 修正の優先順位と具体的な指示を生成

### Step 4: Claude 修正

Geminiのヒントを参考に、指摘事項を修正。

修正後、Step 2 に戻る（最大5回ループ）。

### Step 5: 完了

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ レビュー完了: スコア XX/100
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## コンテキスト再調査のトリガー

以下の条件で Gemini コンテキスト調査を再実行:
1. 同スコア2回連続（根本原因を再分析）
2. 変更ファイルが増減（影響範囲を再分析）
3. Codexが影響範囲に言及（依存関係を再分析）

## ループ制御

| 条件 | アクション |
|------|-----------|
| 80点以上 | 完了 |
| 5回ループ | 強制終了、手動対応を促す |
| 同スコア2回連続 | Gemini深掘り分析後、継続 |

## 使用例

```
/review                    # 未コミット変更全体
/review src/hooks/         # 特定ディレクトリ
/review src/api/users.ts   # 特定ファイル
```
